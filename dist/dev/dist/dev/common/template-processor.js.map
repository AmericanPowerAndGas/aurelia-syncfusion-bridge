{"version":3,"sources":["common/template-processor.js"],"names":[],"mappings":"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","file":"common/template-processor.js","sourceRoot":"/source/","sourcesContent":["import {inject} from 'aurelia-dependency-injection';\r\nimport {Util} from '../common/util';\r\nimport {TemplatingEngine} from 'aurelia-templating';\r\n@inject(TemplatingEngine, Util)\r\nexport class TemplateProcessor {\r\n\r\n  constructor(context, templateEngine) {\r\n    this.context = context;\r\n    this.templatingEngine = templateEngine;\r\n    this.util = new Util();\r\n  }\r\n\r\n  initTemplate() {\r\n    let proxy = this;\r\n    ej.template.render = function(self, selector, data, index) {\r\n      return proxy.renderStringTemplate(self, selector, data, index);\r\n    };\r\n  }\r\n\r\n  initWidgetDependancies() {\r\n    if ( this.context.widget.aureliaTemplate) {\r\n      this.compileTemplate(this.context.widget.element);\r\n    }\r\n    let proxy =  this.context;\r\n    let element =  this.context.widget.element;\r\n    element.on( this.context.widget.pluginName + 'refresh', function() {\r\n      if (proxy.widget.aureliaTemplate) {\r\n        proxy.templateProcessor.compileTemplate(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  renderStringTemplate(self, selector, data, index) {\r\n    let templateObject = self.aureliaTemplate;\r\n    if (!templateObject || !templateObject[selector]) {\r\n      templateObject = templateObject || {};\r\n      templateObject[selector] = { key: ej.getGuid('aurtmpl'), itemData: [], views: [] };\r\n      self.aureliaTemplate = templateObject;\r\n    }\r\n    let scope = templateObject[selector];\r\n    if (this.util.hasValue(index)) {\r\n      scope.itemData[index] = data;\r\n    } else {\r\n      scope.itemData = [data];\r\n    }\r\n    let actElement = $(selector).html();\r\n    let tempElement = \"<div class='\" + templateObject[selector].key + \" ej-aurelia-template'>\" + actElement + '</div>';\r\n    return tempElement;\r\n  }\r\n\r\n  compileTemplate(element) {\r\n    let templates = $(element).find('.ej-aurelia-template');\r\n    let templateObject =  this.context.widget.aureliaTemplate;\r\n    for (let template in templateObject) {\r\n      let tmplElement = templates.filter('.' + templateObject[template].key);\r\n      if (tmplElement.length) {\r\n        for (let i = 0; i < tmplElement.length; i++) {\r\n          let view = this.templatingEngine.enhance(tmplElement[i]);\r\n          view.bind(templateObject[template].itemData[i]);\r\n          templateObject[template].views[i] = view;\r\n        }\r\n      } else {\r\n        this.unbindViews(templateObject[template]);\r\n        delete templateObject[template];\r\n      }\r\n    }\r\n  }\r\n\r\n  clearTempalte() {\r\n    let templateObject =  this.context.widget.aureliaTemplate;\r\n    if (templateObject && Object.keys(templateObject).length) {\r\n      for (let t in templateObject) {\r\n        this.unbindViews(templateObject[t]);\r\n        delete templateObject[t];\r\n      }\r\n    }\r\n  }\r\n\r\n  unbindViews(obj) {\r\n    for (let i = 0; i < obj.views.length; i++) {\r\n      let view = obj.views[i];\r\n      view.unbind();\r\n    }\r\n  }\r\n\r\n}\r\n"]}